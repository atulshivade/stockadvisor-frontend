<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockAdvisor - AI-Powered Stock Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Backend Unavailable Banner (shown on mobile/deployed environments) -->
    <div id="backendBanner" style="display:none;background:linear-gradient(90deg,#ff6b35,#f7931e);color:#fff;padding:0.75rem 1rem;text-align:center;font-size:0.85rem;position:fixed;top:0;left:0;right:0;z-index:9999">
        <strong>ðŸ“± Mobile Demo Mode:</strong> Backend server is running locally. Full functionality available on desktop only.
        <button onclick="this.parentElement.style.display='none'" style="background:transparent;border:none;color:#fff;font-size:1.2rem;cursor:pointer;margin-left:1rem;vertical-align:middle">Ã—</button>
    </div>
    
    <!-- Auth Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>StockAdvisor</h1>
                <p>AI-Powered Stock Analysis</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Sign In</button>
            </form>
            <form id="registerForm" style="display:none">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" class="form-input" id="regFirstName" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" class="form-input" id="regLastName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-input" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-input" id="regPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Create Account</button>
            </form>
            <div id="ssoSection" style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid var(--border)">
                <div style="text-align:center;color:var(--text-muted);margin-bottom:1rem;font-size:0.85rem">Or continue with</div>
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem">
                    <button type="button" class="btn btn-secondary btn-sso-disabled" style="display:flex;align-items:center;justify-content:center;gap:0.4rem;padding:0.6rem 0.5rem;font-size:0.8rem" disabled title="Coming soon - Use Guest login for now">
                        <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Google
                    </button>
                    <button type="button" class="btn btn-secondary btn-sso-disabled" style="display:flex;align-items:center;justify-content:center;gap:0.4rem;padding:0.6rem 0.5rem;font-size:0.8rem" disabled title="Coming soon - Use Guest login for now">
                        <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#F25022" d="M1 1h10v10H1z"/><path fill="#00A4EF" d="M1 13h10v10H1z"/><path fill="#7FBA00" d="M13 1h10v10H13z"/><path fill="#FFB900" d="M13 13h10v10H13z"/></svg>
                        Microsoft
                    </button>
                    <button type="button" class="btn btn-secondary btn-sso-disabled" style="display:flex;align-items:center;justify-content:center;gap:0.4rem;padding:0.6rem 0.5rem;font-size:0.8rem" disabled title="Coming soon - Use Guest login for now">
                        <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#6001D2" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.41 15.06l-1.47-4.2-1.53 4.2H5.65l2.48-6.36-2.26-5.64h2.01l1.35 3.9 1.41-3.9h1.95l-2.29 5.64 2.48 6.36h-2.19zm6.76 0h-1.77l-.9-2.52h-2.22l-.84 2.52h-1.68l3.06-8.06h1.44l2.91 8.06z"/></svg>
                        Yahoo
                    </button>
                </div>
                <div style="text-align:center;color:var(--text-muted);margin-top:0.5rem;font-size:0.7rem;font-style:italic">SSO coming soon - Please use Guest login to test</div>
            </div>
            <div style="margin-top:1.5rem">
                <button type="button" class="btn btn-secondary" style="width:100%;display:flex;align-items:center;justify-content:center;gap:0.5rem" onclick="guestLogin()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    Continue as Guest
                </button>
            </div>
            <div class="auth-toggle">
                <span id="authToggleText">New user?</span>
                <a id="authToggleLink" onclick="toggleAuth()">Create account</a>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="appContainer" style="display:none;flex:1;display:flex;flex-direction:column">
        <header>
            <div class="header-content">
                <div class="logo" onclick="showTab('markets')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 17L9 11L13 15L21 7" stroke="url(#grad)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <defs><linearGradient id="grad" x1="3" y1="7" x2="21" y2="17"><stop stop-color="#00d4aa"/><stop offset="1" stop-color="#00b894"/></linearGradient></defs>
                    </svg>
                    StockAdvisor
                </div>

                <div class="exchange-select">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                    <select id="exchangeSelect" onchange="onExchangeChange()">
                        <option value="US">United States</option>
                        <option value="NSE">India (NSE)</option>
                        <option value="LSE">UK (London)</option>
                        <option value="TSE">Japan (Tokyo)</option>
                        <option value="HKEX">Hong Kong</option>
                    </select>
                    <span class="currency-badge" id="currencyBadge">USD</span>
                </div>

                <div class="search-wrapper">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search stocks (e.g., AAPL, DOX, NIO)..." autocomplete="off">
                    <div class="search-results" id="searchResults"></div>
                </div>

                <nav>
                    <button class="nav-btn active" data-tab="markets" onclick="showTab('markets')">Markets</button>
                    <button class="nav-btn" data-tab="portfolio" onclick="showTab('portfolio')">Portfolio</button>
                    <button class="nav-btn" data-tab="watchlist" onclick="showTab('watchlist')">Watchlist</button>
                    <button class="nav-btn" data-tab="alerts" onclick="showTab('alerts')">Alerts</button>
                    <button class="nav-btn" data-tab="aipicks" onclick="showTab('aipicks')">AI Picks</button>
                    <button class="nav-btn" data-tab="feedback" onclick="showTab('feedback')" id="feedbackNavBtn" style="display:none">Feedback</button>
                    <button class="nav-btn" data-tab="admin" onclick="showTab('admin')" id="adminNavBtn" style="display:none">Admin</button>
                    <button class="nav-btn" data-tab="sanity" onclick="showTab('sanity')" id="sanityNavBtn" style="display:none">Sanity Report</button>
                </nav>

                <div class="user-section">
                    <button class="feedback-btn" onclick="openFeedbackModal()">Send Feedback</button>
                    <div class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">
                        <span id="userInitials">U</span>
                        <span class="admin-indicator" id="adminBadge" style="display:none">â˜…</span>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="dropdown-item" onclick="showTab('portfolio')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                                My Portfolio
                            </div>
                            <div class="dropdown-item" onclick="showTab('watchlist')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                My Watchlist
                            </div>
                            <div class="dropdown-item" onclick="openFeedbackModal()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                Send Feedback
                            </div>
                            <div class="dropdown-item danger" onclick="logout()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                                Logout
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <aside class="sidebar">
                <div class="card" id="watchlistCard">
                    <div class="card-header">
                        <h3 class="card-title">Watchlist</h3>
                        <span class="ai-badge">LIVE</span>
                    </div>
                    <div id="sidebarWatchlist"><div class="loading"><div class="spinner"></div>Loading...</div></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Quick Stats</h3>
                    </div>
                    <div id="quickStats">
                        <div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid var(--border)">
                            <span style="color:var(--text-muted)">Portfolio Value</span>
                            <span id="quickPortfolioValue" style="font-weight:600;font-family:var(--font-mono)">$0</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid var(--border)">
                            <span style="color:var(--text-muted)">Day Change</span>
                            <span id="quickDayChange" style="font-weight:600;font-family:var(--font-mono)">$0</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;padding:0.5rem 0">
                            <span style="color:var(--text-muted)">Total Gain</span>
                            <span id="quickTotalGain" style="font-weight:600;font-family:var(--font-mono)">$0</span>
                        </div>
                    </div>
                </div>
            </aside>

            <section class="dashboard">
                <!-- Markets Tab -->
                <div id="marketsTab" class="tab-content">
                    <div class="stats-grid" id="marketStats">
                        <div class="stat-card"><div class="stat-label">Top Gainer</div><div class="stat-value" id="topGainer">-</div><div class="stat-change positive" id="topGainerChange">+0%</div></div>
                        <div class="stat-card"><div class="stat-label">Top Loser</div><div class="stat-value" id="topLoser">-</div><div class="stat-change negative" id="topLoserChange">-0%</div></div>
                        <div class="stat-card"><div class="stat-label">Most Active</div><div class="stat-value" id="mostActive">-</div><div class="stat-change" id="mostActiveVol">0M vol</div></div>
                        <div class="stat-card"><div class="stat-label">Market Mood</div><div class="stat-value" id="marketMood">-</div><div class="stat-change" id="marketMoodDesc">Neutral</div></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">Market Overview</h3><span class="ai-badge">LIVE DATA</span></div>
                        <div id="marketTable"><div class="loading"><div class="spinner"></div>Loading market data...</div></div>
                    </div>
                </div>

                <!-- Portfolio Tab -->
                <div id="portfolioTab" class="tab-content" style="display:none">
                    <div class="stats-grid" id="portfolioStats"></div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">My Holdings</h3></div>
                        <div id="portfolioTable"><div class="loading"><div class="spinner"></div>Loading portfolio...</div></div>
                    </div>
                </div>

                <!-- Watchlist Tab -->
                <div id="watchlistTab" class="tab-content" style="display:none">
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">My Watchlist</h3></div>
                        <div id="watchlistTable"><div class="loading"><div class="spinner"></div>Loading watchlist...</div></div>
                    </div>
                </div>

                <!-- Stock Alerts Tab -->
                <div id="alertsTab" class="tab-content" style="display:none">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Stock Alerts</h3>
                            <button class="btn btn-primary btn-small" onclick="openAlertModal()">+ New Alert</button>
                        </div>
                        <div id="alertsList"><div class="loading"><div class="spinner"></div>Loading alerts...</div></div>
                    </div>
                </div>

                <!-- AI Picks Tab -->
                <div id="aipicksTab" class="tab-content" style="display:none">
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">AI Recommendations</h3><span class="ai-badge">AI POWERED</span></div>
                        <div id="aiPicksTable"><div class="loading"><div class="spinner"></div>Analyzing stocks...</div></div>
                    </div>
                </div>

                <!-- Feedback Tab (Admin) -->
                <div id="feedbackTab" class="tab-content" style="display:none">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Feedback Dashboard</h3>
                            <div class="tabs" style="margin:0">
                                <button class="tab active" onclick="filterFeedback(null)">All</button>
                                <button class="tab" onclick="filterFeedback('new')">New</button>
                                <button class="tab" onclick="filterFeedback('in_progress')">In Progress</button>
                                <button class="tab" onclick="filterFeedback('resolved')">Resolved</button>
                            </div>
                        </div>
                        <div id="feedbackList"><div class="loading"><div class="spinner"></div>Loading feedback...</div></div>
                    </div>
                </div>

                <!-- Admin Tab -->
                <div id="adminTab" class="tab-content" style="display:none">
                    <div class="stats-grid" id="adminStats"></div>
                    <div class="card">
                        <div class="card-header"><h3 class="card-title">User Management</h3></div>
                        <div id="usersList"><div class="loading"><div class="spinner"></div>Loading users...</div></div>
                    </div>
                    <div class="card" style="margin-top:1.5rem">
                        <div class="card-header">
                            <h3 class="card-title">Guest Sessions</h3>
                            <span class="ai-badge">DEVICE TRACKING</span>
                        </div>
                        <div id="guestSessionsList"><div class="loading"><div class="spinner"></div>Loading guest sessions...</div></div>
                    </div>
                </div>

                <!-- Sanity Report Tab -->
                <div id="sanityTab" class="tab-content" style="display:none">
                    <div class="stats-grid" id="sanityStats">
                        <div class="stat-card"><div class="stat-label">Total Tests</div><div class="stat-value" id="sanityTotal">0</div></div>
                        <div class="stat-card"><div class="stat-label">Passed</div><div class="stat-value" id="sanityPassed" style="color:var(--positive)">0</div></div>
                        <div class="stat-card"><div class="stat-label">Failed</div><div class="stat-value" id="sanityFailed" style="color:var(--negative)">0</div></div>
                        <div class="stat-card"><div class="stat-label">Errors</div><div class="stat-value" id="sanityErrors" style="color:var(--warning)">0</div></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Sanity Test Results</h3>
                            <button class="btn btn-primary btn-small" onclick="runSanityTests()">Run All Tests</button>
                        </div>
                        <div id="sanityResults"><div class="empty-state">Click "Run All Tests" to execute sanity tests</div></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="feedbackModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Send Feedback</h3>
                <button class="modal-close" onclick="closeFeedbackModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Feedback Type</label>
                    <select class="form-select" id="feedbackType">
                        <option value="bug">Bug Report</option>
                        <option value="feature">Feature Request</option>
                        <option value="improvement">Improvement</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Your Feedback</label>
                    <textarea class="form-textarea" id="feedbackMessage" placeholder="Describe your feedback in detail..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeFeedbackModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitFeedback()">Submit</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="portfolioModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="portfolioModalTitle">Add to Portfolio</h3>
                <button class="modal-close" onclick="closePortfolioModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="portfolioModalStock" style="margin-bottom:1rem"></div>
                <div class="form-group">
                    <label>Quantity (Shares)</label>
                    <input type="number" class="form-input" id="portfolioQty" min="1" value="10">
                </div>
                <div class="form-group">
                    <label>Buy Price (<span id="portfolioCurrencyLabel">$</span>)</label>
                    <input type="number" class="form-input" id="portfolioPrice" step="0.01" min="0.01">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePortfolioModal()">Cancel</button>
                <button class="btn btn-primary" id="portfolioModalSubmit" onclick="confirmAddPortfolio()">Add to Portfolio</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="stockModal">
        <div class="modal" style="max-width:600px">
            <div class="modal-header">
                <h3 id="stockModalTitle">Stock Details</h3>
                <button class="modal-close" onclick="closeStockModal()">&times;</button>
            </div>
            <div class="modal-body" id="stockModalBody"><div class="loading"><div class="spinner"></div>Loading...</div></div>
        </div>
    </div>

    <div class="modal-overlay" id="alertModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="alertModalTitle">Create Stock Alert</h3>
                <button class="modal-close" onclick="closeAlertModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Stock Symbol</label>
                    <input type="text" class="form-input" id="alertSymbol" placeholder="e.g., RELIANCE, TCS" style="text-transform:uppercase">
                </div>
                <div class="form-group">
                    <label>Entry Price (<span id="alertCurrencyLabel">â‚¹</span>)</label>
                    <input type="number" class="form-input" id="alertEntryPrice" step="0.01" min="0.01" placeholder="Current market price">
                </div>
                <div class="form-group">
                    <label>Stop Loss (<span id="alertSLCurrencyLabel">â‚¹</span>)</label>
                    <input type="number" class="form-input" id="alertStopLoss" step="0.01" min="0.01" placeholder="Price to exit if falling">
                </div>
                <div class="form-group">
                    <label>Target Price (<span id="alertTargetCurrencyLabel">â‚¹</span>)</label>
                    <input type="number" class="form-input" id="alertTargetPrice" step="0.01" min="0.01" placeholder="Expected price target">
                </div>
                <div class="form-group">
                    <label>Rationale (Optional)</label>
                    <textarea class="form-textarea" id="alertRationale" placeholder="Why this trade? Technical analysis, news, etc."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAlertModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createAlert()">Create Alert</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div style="max-width:1600px;margin:0 auto">
            Developed by <strong>Atul Shivade</strong> &copy;2026 &nbsp;|&nbsp; <a href="mailto:atul.shivade@gmail.com">atul.shivade@gmail.com</a>
        </div>
    </footer>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
